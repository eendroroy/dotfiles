#!/usr/bin/env bash

# Copyright (C) Indrajit Roy <eendroroy@gmail.com>
#
# SPDX-License-Identifier: AGPL-3.0-or-later
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.


T001="ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜"
T002="îˆî‰îŠî‹îŒîîîîî‘î’î“î”î•î–î—î˜î™îšî›îœîîîŸî î¡î¢î£"
T003=" îîîî‘î’î“î”î•î–î—î˜î™îšî›îœîîîŸî î¡î¢î£î¤î¥î¦î§î¨"
T004="â—â—“â—‘â—’"
T005="â â ‚â „â¡€â¢€â  â â ˆ"
T006="â–â–‚â–ƒâ–„â–…â–†â–‡â–ˆâ–‡â–†â–…â–„â–ƒâ–‚"
T007="â ‹â ™â ¹â ¸â ¼â ´â ¦â §â ‡â "
T008="|/-\\"
T009="â—¢â—£â—¤â—¥"
T010="â—°â—³â—²â—±"
T011="â â ƒâ ‡â¡‡â¡§â¡·â£·â£¯â£Ÿâ¡¿â¢¿â£»â£½â£¾"
T012="â ‹â ™â šâ â –â ¦â ´â ²â ³â “"
T013="â „â †â ‡â ‹â ™â ¸â °â  "
T014="â â ‰â ™â šâ ’â ‚"
T015="â â ˆâ â  â¢€"
T016="â â ƒâ ‰â ™â šâ ’â ‚"

function __loop_over() {
  __data=${1}
  for ((l=1; l<=1000; l++)); do
    for (( i=0; i<${#__data}; i++ )); do
      char="${__data:i:1}"
      printf "\r%s" "${char}"
      sleep "${2}"
    done
  done
}

function __help() {
  echo -e "\033[1;36mUsage:\033[0m show_loader [options]"
  echo ""
  echo -e "\033[1;36mOptions:\033[0m"
  echo -e "  \033[1;33m-h, --help\033[0m            Show this help message and exit"
  echo -e "  \033[1;33m-t, --template NUMBER\033[0m Use a predefined template for the loader animation."
  echo "                        Available types:"
  echo "                          001: 'ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜'"
  echo "                          002: 'îˆî‰îŠî‹îŒîîîîî‘î’î“î”î•î–î—î˜î™îšî›îœîîîŸî î¡î¢î£'"
  echo "                          003: ' îîîî‘î’î“î”î•î–î—î˜î™îšî›îœîîîŸî î¡î¢î£î¤î¥î¦î§î¨'"
  echo "                          004: 'â—â—“â—‘â—’'"
  echo "                          005: 'â â ‚â „â¡€â¢€â  â â ˆ'"
  echo "                          006: 'â–â–‚â–ƒâ–„â–…â–†â–‡â–ˆâ–‡â–†â–…â–„â–ƒâ–‚'"
  echo "                          007: 'â ‹â ™â ¹â ¸â ¼â ´â ¦â §â ‡â '"
  echo "                          008: '|/-\\'"
  echo "                          009: 'â—¢â—£â—¤â—¥'"
  echo "                          010: 'â—°â—³â—²â—±'"
  echo "                          011: 'â â ƒâ ‡â¡‡â¡§â¡·â£·â£¯â£Ÿâ¡¿â¢¿â£»â£½â£¾'"
  echo "                          012: 'â ‹â ™â šâ â –â ¦â ´â ²â ³â “'"
  echo "                          013: 'â „â †â ‡â ‹â ™â ¸â °â  '"
  echo "                          014: 'â â ‰â ™â šâ ’â ‚'"
  echo "                          015: 'â â ˆâ â  â¢€'"
  echo "                          016: 'â â ƒâ ‰â ™â šâ ’â ‚'"
  echo ""
  echo -e "  \033[1;33m-d, --data STRING\033[0m     Custom string of characters to use for the loader animation."
  echo "                        Overrides the template option if both are provided."
  echo ""
  echo -e "  \033[1;33m-i, --interval FLOAT\033[0m  Set the interval (in seconds) between each character display."
  echo "                        Default is 0.1 seconds."
  echo ""
  echo -e "\033[1;36mExamples:\033[0m"
  echo "  show_loader -t 001"
  echo "  show_loader -t 001 -i 0.2"
  echo "  show_loader -d 'â â ‚â „â¡€â¢€â  â â ˆ' -i 0.05"
}

declare _DATA
declare _INTERVAL

_DATA="${T9}"
_INTERVAL=0.1

if [[ $# -eq 0 ]]; then
  __help
  exit
fi

while [[ $# -gt 0 ]]; do
  case "$1" in
    -h|--help)
      __help
      exit ;;
    -t|--template)
      shift
      if [[ "$1" =~ ^[0-9]+$ ]]; then
        __var_name="T$1"
        _DATA="${!__var_name}"
      else
        __help
        exit 1
      fi
      ;;
    -d|--data)
      shift
      _DATA="${1}"
      ;;
    -i|--interval)
      shift
      _INTERVAL="${1}"
      ;;
    *)
      __help
      exit 1 ;;
  esac
  shift
done

if [[ -z "${_DATA}" ]]; then
  __help
else
  __loop_over "${_DATA}" "${_INTERVAL}"
fi
