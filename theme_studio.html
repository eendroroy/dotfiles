<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terminal Theme Studio</title>
    <script src="https://cdn.jsdelivr.net/npm/@jaames/iro@5"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');

        :root {
            --bg-color: #0A0A0D;
            --fg-color: #909090;
            --black-normal: #404040;   --black-bright: #4D4D4D;   --black-dim: #262626;
            --red-normal: #B37E7E;     --red-bright: #CCA4A4;     --red-dim: #8F5B5B;
            --green-normal: #7EB37E;   --green-bright: #A4CCA4;   --green-dim: #5B8F5B;
            --yellow-normal: #B3B37E;  --yellow-bright: #CCCCA4;  --yellow-dim: #8F8F5B;
            --blue-normal: #7F89B3;    --blue-bright: #A4B0CC;    --blue-dim: #5B648F;
            --magenta-normal: #B37EB3; --magenta-bright: #CCA4CC; --magenta-dim: #8F5B8F;
            --cyan-normal: #7EB3B3;    --cyan-bright: #A4CCCC;    --cyan-dim: #5B8F8F;
            --white-normal: #B3B3B3;   --white-bright: #CCCCCC;   --white-dim: #8F8F8F;
        }

        body { background-color: #070708; display: flex; margin: 0; font-family: 'Segoe UI', sans-serif; color: #eee; height: 100vh; overflow: hidden; }
        .panel { background: #121215; border-color: #252529; border-style: solid; height: 100vh; display: flex; flex-direction: column; box-sizing: border-box; z-index: 20; }
        .left-panel { border-right-width: 1px; width: 420px; padding: 10px; }
        .right-panel { border-left-width: 1px; width: 450px; padding: 10px; }

        #random-controls { display: flex; gap: 8px; margin-bottom: 15px; }
        .rnd-btn {
            flex: 1; border: 1px solid #333; padding: 8px; border-radius: 4px;
            cursor: pointer; font-size: 11px; font-weight: bold; transition: 0.2s;
            text-transform: uppercase; letter-spacing: 0.5px;
        }
        .dark-btn { background: #1a1a1c; color: #4cc9f0; }
        .light-btn { background: #e0e0e0; color: #121215; }
        .rnd-btn:hover { opacity: 0.8; transform: translateY(-1px); }

        #picker-area {
            background: #18181b; border-radius: 8px; border: 1px solid #2d2d31;
            padding: 12px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px;
        }

        .IroLayoutDirectionRow { display: flex; gap: 10px; width: 100%; }
        .IroLayoutDirectionRow .iro-slider { flex: 1; }

        .picker-header { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .contrast-badge {
            font-size: 9px; padding: 3px 8px; border-radius: 4px; background: #0a0a0c; color: #aaa;
            font-weight: bold; border: 1px solid #333; font-family: 'JetBrains Mono', monospace;
        }
        .active-var-label {
            font-weight: bold; color: #4cc9f0; font-family: 'JetBrains Mono', monospace;
            font-size: 11px; text-transform: uppercase;
        }

        .hex-input-wrapper { width: 100%; display: flex; gap: 6px; }
        #manual-hex-input, #manual-val-input {
            background: #0a0a0c; border: 1px solid #333; color: #4cc9f0;
            font-family: 'JetBrains Mono', monospace; padding: 6px; border-radius: 4px;
            font-size: 13px; outline: none;
        }
        #manual-hex-input { flex: 3; text-align: center; text-transform: uppercase; }
        #manual-val-input { flex: 1; text-align: center; color: #888; }

        .nav-list { flex-grow: 1; overflow-y: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        .nav-item { display: flex; align-items: center; padding: 6px 10px; background: #18181b; border: 1px solid #2d2d31; border-radius: 4px; cursor: pointer; transition: 0.1s; gap: 8px; }
        .nav-item.active { border-color: #4cc9f0; background: #1c1c21; }
        .nav-swatch { width: 12px; height: 12px; border-radius: 2px; border: 1px solid rgba(255,255,255,0.1); }
        .nav-text { font-size: 11px; color: #bbb; flex-grow: 1; }
        .nav-hex { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: #555; }

        /* TRANSPARENT PAPER TEXTURE */
        .main-content {
            flex-grow: 1; display: flex; flex-direction: column; justify-content: flex-start; align-items: center; gap: 30px;
            background-color: var(--bg-color);
            position: relative;
            overflow-y: auto; padding: 40px 0; transition: background-color 0.3s ease;
        }

        .main-content::before {
            content: "";
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("https://www.transparenttextures.com/patterns/pinstriped-suit.png");
            opacity: 0.4;
            pointer-events: none;
            mix-blend-mode: overlay; /* Allows texture to work on both dark and light */
        }

        .terminal-window {
            z-index: 1; width: 500px; background-color: var(--bg-color); border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.6); border: 1px solid rgba(255,255,255,0.1);
            overflow: hidden; font-family: 'JetBrains Mono', monospace; min-height: 320px;
        }
        .terminal-header { background: rgba(255, 255, 255, 0.05); padding: 10px 15px; display: flex; gap: 8px; }
        .dot { width: 10px; height: 10px; border-radius: 50%; }
        .dot.red { background: #ff5f56; }
        .dot.yellow { background: #ffbd2e; }
        .dot.green { background: #27c93f; }

        .terminal-body { padding: 25px; font-size: 14px; line-height: 1.6; color: var(--fg-color); }
        .prompt { color: var(--green-normal); font-weight: bold; }
        .path { color: var(--blue-bright); }
        .git { color: var(--magenta-normal); opacity: 0.8; }

        .preview-container {
            z-index: 1; width: 450px; padding: 25px; border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px; background: rgba(0, 0, 0, 0.3); font-family: 'JetBrains Mono', monospace;
        }
        .grid-preview { display: grid; grid-template-columns: 100px 75px 75px 75px 40px 40px 40px; gap: 4px 0px; align-items: center; }
        .cell { font-size: 13px; padding: 6px 8px; cursor: pointer; white-space: nowrap; }
        .label { color: var(--fg-color); cursor: default; opacity: 0.7; font-weight: 500; }
        .block-cell { margin-left: 8px; color: rgba(0,0,0,0.5); font-weight: 800; text-align: center; border-radius: 4px; padding: 4px 0; }

        .config-table { width: 100%; border-collapse: collapse; flex-grow: 1; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; }
        .config-section { border: 1px solid #2d2d31; border-radius: 4px; background: #0a0a0c; display: flex; flex-direction: column; }
        .config-header { background: #1c1c21; padding: 8px 12px; font-size: 10px; font-weight: bold; color: #4cc9f0; border-bottom: 1px solid #2d2d31; display: flex; justify-content: space-between; align-items: center; }
        .config-content { padding: 12px; font-size: 10px; color: #aaa; font-family: 'JetBrains Mono', monospace; white-space: pre; overflow-x: auto; margin: 0; }
        .copy-btn-sm { background: #333; color: #eee; border: none; padding: 2px 8px; border-radius: 3px; cursor: pointer; font-size: 9px; }
    </style>
</head>
<body>

<div class="panel left-panel">
    <div id="random-controls">
        <button class="rnd-btn dark-btn" onclick="generateRandomTheme('dark')">Random Dark</button>
        <button class="rnd-btn light-btn" onclick="generateRandomTheme('light')">Random Light</button>
    </div>

    <div id="picker-area">
        <div class="picker-header">
            <div class="active-var-label" id="current-var-display">SELECT COLOR</div>
            <div id="contrast-info" class="contrast-badge">RATIO --</div>
        </div>
        <div id="picker-container" style="display: flex; justify-content: center;"></div>
        <div class="hex-input-wrapper">
            <input type="text" id="manual-hex-input" placeholder="#HEX" maxlength="7">
            <input type="number" id="manual-val-input" placeholder="VAL" min="0" max="100">
        </div>
    </div>

    <div class="nav-list" id="nav-list"></div>
</div>

<div class="main-content">
    <div class="terminal-window">
        <div class="terminal-header"><div class="dot red"></div><div class="dot yellow"></div><div class="dot green"></div></div>
        <div class="terminal-body">
            <div class="cmd-line">
                <span class="prompt">➜</span> <span class="path">~/studio</span> <span class="git">git:(<span class="txt-magenta-dim">main</span>)</span> <span class="txt-cyan-normal">npm</span> build
            </div>
            <div style="margin-left: 15px;">
                <span class="txt-white-dim">indexing...</span><br>
                <span class="txt-green-bright">✓</span> Build completed in <span class="txt-yellow-normal">420ms</span><br>
                <span class="txt-red-normal">!</span> Warning: <span class="txt-white-normal">unused variable 'theme'</span>
            </div>
            <br>
            <div class="cmd-line">
                <span class="prompt">➜</span> <span class="path">~/studio</span> <span class="txt-cyan-normal">ls</span> -tree
            </div>
            <div style="line-height: 1.4;">
                <span class="txt-blue-normal">.</span><br>
                <span class="txt-black-bright">├──</span> <span class="txt-blue-normal">assets/</span> <span class="txt-black-dim">(dimmed)</span><br>
                <span class="txt-black-bright">│   └──</span> logo.svg<br>
                <span class="txt-black-bright">├──</span> <span class="txt-blue-normal">src/</span><br>
                <span class="txt-black-bright">│   ├──</span> <span class="txt-yellow-bright">App.js</span><br>
                <span class="txt-black-bright">│   └──</span> <span class="txt-magenta-normal">styles.css</span><br>
                <span class="txt-black-bright">└──</span> README.md
            </div>
        </div>
    </div>

    <div class="preview-container">
        <div class="grid-preview" id="grid-preview"></div>
    </div>
</div>

<div class="panel right-panel">
    <div class="config-table">
        <div class="config-section">
            <div class="config-header">GHOSTTY <button class="copy-btn-sm" onclick="copyText('ghostty-output')">COPY</button></div>
            <pre id="ghostty-output" class="config-content"></pre>
        </div>
        <div class="config-section">
            <div class="config-header">ALACRITTY (TOML) <button class="copy-btn-sm" onclick="copyText('alacritty-output')">COPY</button></div>
            <pre id="alacritty-output" class="config-content"></pre>
        </div>
    </div>
</div>

<script>
    const colors = ['Black', 'Red', 'Green', 'Yellow', 'Blue', 'Magenta', 'Cyan', 'White'];
    const types = ['dim', 'normal', 'bright'];
    let currentVar = null;
    const root = document.documentElement;
    const hexInput = document.getElementById('manual-hex-input');
    const valInput = document.getElementById('manual-val-input');

    const colorPicker = new iro.ColorPicker("#picker-container", {
        width: 160,
        color: "#909090",
        borderWidth: 1,
        borderColor: "#333",
        layout: [
            { component: iro.ui.Wheel },
            {
                component: iro.ui.Slider,
                options: { sliderType: 'saturation' },
                onCreate: function(el) { el.parentElement.classList.add('IroLayoutDirectionRow'); }
            },
            { component: iro.ui.Slider, options: { sliderType: 'value' } }
        ]
    });

    colorPicker.on('color:change', (color) => {
        hexInput.value = color.hexString.toUpperCase();
        valInput.value = Math.round(color.value);
        if (currentVar) updateColorVar(currentVar, color.hexString);
    });

    hexInput.addEventListener('input', (e) => {
        let val = e.target.value;
        if (!val.startsWith('#')) val = '#' + val;
        if (/^#[0-9A-F]{6}$/i.test(val)) colorPicker.color.set(val);
    });

    valInput.addEventListener('input', (e) => {
        let v = parseInt(e.target.value);
        if (!isNaN(v) && v >= 0 && v <= 100) colorPicker.color.setChannel('hsv', 'v', v);
    });

    function generateRandomTheme(mode) {
        const isDark = mode === 'dark';
        const bgColor = isDark ? iro.Color.hsvToRgb({ h: Math.random() * 360, s: 15, v: 8 }) : iro.Color.hsvToRgb({ h: Math.random() * 360, s: 8, v: 92 });
        const fgColor = isDark ? "#A0A0A0" : "#202020";
        updateColorVar('--bg-color', rgbToHex(bgColor));
        updateColorVar('--fg-color', fgColor);
        colors.forEach(color => {
            const hue = Math.random() * 360;
            const low = color.toLowerCase();
            updateColorVar(`--${low}-normal`, rgbToHex(iro.Color.hsvToRgb({ h: hue, s: 45, v: 75 })));
            updateColorVar(`--${low}-bright`, rgbToHex(iro.Color.hsvToRgb({ h: hue, s: 35, v: 90 })));
            updateColorVar(`--${low}-dim`, rgbToHex(iro.Color.hsvToRgb({ h: hue, s: 55, v: 45 })));
        });
        selectVar('--bg-color', 'Background');
    }

    function rgbToHex(rgb) { const s = (x) => Math.round(x).toString(16).padStart(2, '0'); return `#${s(rgb.r)}${s(rgb.g)}${s(rgb.b)}`.toUpperCase(); }
    function getLuminance(hex) { const rgb = hex.replace('#', '').match(/.{2}/g).map(x => { let v = parseInt(x, 16) / 255; return v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4); }); return 0.2126 * rgb[0] + 0.7152 * rgb[1] + 0.0722 * rgb[2]; }

    function updateContrastDisplay() {
        const bg = getComputedStyle(root).getPropertyValue('--bg-color').trim(), fg = getComputedStyle(root).getPropertyValue('--fg-color').trim();
        const l1 = getLuminance(bg), l2 = getLuminance(fg);
        const ratio = (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);
        const display = document.getElementById('contrast-info');
        display.innerText = `${ratio.toFixed(1)}:1`;
        display.style.borderColor = ratio < 3 ? '#ff5f56' : (ratio < 4.5 ? '#ffbd2e' : '#27c93f');
    }

    function updateColorVar(varName, hex) {
        root.style.setProperty(varName, hex);
        const item = document.querySelector(`[data-var="${varName}"]`);
        if (item) { item.querySelector('.nav-swatch').style.backgroundColor = hex; item.querySelector('.nav-hex').innerText = hex.toUpperCase(); }
        updateConfig(); updateContrastDisplay();
    }

    function selectVar(varName, label) {
        currentVar = varName;
        document.getElementById('current-var-display').innerText = label.toUpperCase();
        document.querySelectorAll('.nav-item').forEach(i => i.classList.toggle('active', i.dataset.var === varName));
        const hex = getComputedStyle(root).getPropertyValue(varName).trim();
        colorPicker.color.set(hex); hexInput.value = hex.toUpperCase(); valInput.value = Math.round(colorPicker.color.value);
    }

    function createNavItem(v, label) {
        const hex = getComputedStyle(root).getPropertyValue(v).trim();
        const div = document.createElement('div'); div.className = 'nav-item'; div.dataset.var = v;
        div.innerHTML = `<div class="nav-swatch" style="background:${hex}"></div><div class="nav-text">${label}</div><div class="nav-hex">${hex}</div>`;
        div.onclick = () => selectVar(v, label); document.getElementById('nav-list').appendChild(div);
    }

    createNavItem('--bg-color', 'Background');
    createNavItem('--fg-color', 'Foreground');

    const grid = document.getElementById('grid-preview');
    colors.forEach(color => {
        const low = color.toLowerCase();
        types.forEach(t => {
            const style = document.createElement('style'); style.innerHTML = `.txt-${low}-${t} { color: var(--${low}-${t}); } .bg-${low}-${t} { background-color: var(--${low}-${t}); }`;
            document.head.appendChild(style); createNavItem(`--${low}-${t}`, `${color} ${t}`);
        });
        let rowHtml = `<div class="cell label">${color}</div>`;
        types.forEach(t => { rowHtml += `<div class="cell txt-${low}-${t}" onclick="selectVar('--${low}-${t}', '${color} ${t}')">${t}</div>`; });
        types.forEach(t => { rowHtml += `<div class="cell block-cell bg-${low}-${t}" onclick="selectVar('--${low}-${t}', '${color} ${t}')">${t.charAt(0).toUpperCase()}</div>`; });
        grid.innerHTML += rowHtml;
    });

    function updateConfig() {
        const getV = (n) => getComputedStyle(root).getPropertyValue(n).trim().toUpperCase();
        let g = `# Ghostty\nbackground = ${getV('--bg-color')}\nforeground = ${getV('--fg-color')}\n\n`;
        colors.forEach((c, i) => g += `palette = ${i}=${getV('--'+c.toLowerCase()+'-normal')}\n`);
        colors.forEach((c, i) => g += `palette = ${i+8}=${getV('--'+c.toLowerCase()+'-bright')}\n`);
        document.getElementById('ghostty-output').innerText = g;
        let a = `[colors.primary]\nbackground = "${getV('--bg-color')}"\nforeground = "${getV('--fg-color')}"\n\n`;
        ['normal', 'bright', 'dim'].forEach(sec => { a += `[colors.${sec}]\n`; colors.forEach(c => a += `${c.toLowerCase()} = "${getV('--'+c.toLowerCase()+'-'+sec)}"\n`); a += `\n`; });
        document.getElementById('alacritty-output').innerText = a;
    }

    function copyText(id) { navigator.clipboard.writeText(document.getElementById(id).innerText); }
    updateConfig(); updateContrastDisplay(); selectVar('--bg-color', 'Background');
</script>
</body>
</html>