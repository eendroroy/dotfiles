#!/usr/bin/env bash

# Copyright (C) 2025 Indrajit Roy <eendroroy@gmail.com>
#
# SPDX-License-Identifier: AGPL-3.0-or-later
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU Affero General Public License as
# published by the Free Software Foundation, either version 3 of the
# License, or (at your option) any later version.

SCRIPT_LOCATION="$( cd "$( dirname "${BASH_SOURCE[0]}" )" >/dev/null 2>&1 && pwd )" && export SCRIPT_LOCATION

# directories
__FUNCTIONS_DIR="${SCRIPT_LOCATION}/__functions"
__PREINSTALL_DIR="${SCRIPT_LOCATION}/__before_dotfiles"
__BEFORE_DIR="${SCRIPT_LOCATION}/__before_dots"
__AFTER_DIR="${SCRIPT_LOCATION}/__dots_after"
__DOTS_DIR="${SCRIPT_LOCATION}/__dots"

__INSTALLATION_CACHE_FILE="${SCRIPT_LOCATION}/.cache/installation"

source "${__DOTS_DIR}/rel:.local/share/bash/lib/ansi_text_style.sh.generic.symlink"

for file in "${__FUNCTIONS_DIR}/"*.sh; do
  # shellcheck source=__functions/*.sh
  source "${file}"
done

__VERBOSE=false __FORCE=false __STATUS=false __DRY=false

__parse_common_args() {
  while [[ $# -gt 0 ]]; do
    case "$1" in
      -s|--status ) __STATUS=true  ;;
      -v|--verbose) __VERBOSE=true ;;
      -f|--force  ) __FORCE=true   ;;
      -d|--dry    ) __DRY=true     ;;
      *) ;;
    esac
    shift
  done
}

export __VERBOSE __FORCE __STATUS __DRY

case "$1" in
  h|help     ) shift;                           __help     ; exit 0 ;;
  l|list     ) shift; __parse_common_args "$@"; __list     ; exit 0 ;;
  i|install  ) shift; __parse_common_args "$@"; __install  ; exit 0 ;;
  u|uninstall) shift; __parse_common_args "$@"; __uninstall; exit 0 ;;
  *          ) shift;                           __help     ; exit 0 ;;
esac
